## 导 言

存储证明是一种跟踪区块链信息的加密方式，以便可以跨链共享。 与预言机类似，存储证明提供信息真实性的证明。 然而，与预言机不同的是，它们*而不是*需要信任第三方来提供此证明；相反，通过存储证明，信任就建立在存储中。

在某些情况下，存储证明可以取代预言机。 在其他情况下，存储证明可以增强它们并开辟以前不可能的新区块链用例。

因此，让我们详细了解一下存储证明——它们是什么、它们如何工作、它们的用例以及它们如何增强（有时取代）预言机。

## 什么是存储证明？

存储证明允许您打开状态的加密承诺，可以通过将它们与 S\[N/T]ARKS 结合来优化它们。 . 这些有效性证明证明特定状态在过去的特定区块中存在并且有效。

从根本上来说，区块链是包含使用 Merkle 树、Merkle Patricia 树、Verkle 树等以加密方式提交的数据的数据库。 由于所有数据都已提交，我们可以证明某些信息被封装在给定的状态中。 然而，对于简单的承诺方案，随着其包含的数据的大小变大，该证明的大小变得更加突出。 在链上验证此类证明的成本太高，不切实际。

另一方面，当与 STARK 或 SNARK 结合使用时，存储证明可以相对较小，并且允许您在特定时间点和任何域上验证特定的状态，而无需信任第三方。 他们不依赖第三方，而是依赖底层链本身的安全性。

为什么这很重要？ 今天的以太坊不再像几年前那样是简单的整体链（L1）。 随着 L2 解决方案的出现，数据现在分布在多个链上。

无法再对链的状态做出同步假设。 许多用于共享数据的解决方案现已上线，例如>L2 消息传递系统、跨链桥和预言机。 但当前这些解决方案的问题在于，它们包括对第三方的信任，例如中继者、多重签名者和委员会。 存储证明允许我们在不信任第三方的情况下使用加密承诺在任何时间点验证区块链的状态。

## 存储证明的用例

由于存储证明允许我们有效地“压缩”区块链并将数据传输到其他地方，因此它们有相当多的应用程序。 负担得起的验证成本是存储证明的一个组成部分，允许在*目的地*链上验证证明，从而最大限度地减少开发跨链消息传递系统的需要。

潜在的用例包括：

* **一条链从另一条链访问有关区块链上的状态和交易的一般信息**。
* **简化的跨链投票系统**. 用户通常将资产保存在缓慢但更安全的链 A 上，但一些基于代币的投票发生在交易更便宜的链 B 上。 这迫使用户要么跳过投票，要么支付巨额交易费用，将其资产从 A 桥接至 B，进行投票，然后桥接回 A。在这种情况下，存储证明使用户能够证明其在链 A 上的代币余额在给定的区块上无缝地在链 B 上投票。
* **跨链桥的替代方案**. 目前，跨链桥假设对第三方有一定程度的信任，因为它们通常涉及中介机构，例如托管人或去中心化自治组织（DAO）。 该中介机构负责确保中介机构在源链上收到一定数量的代币，并持有源链上的资产。 然后，在目标链上铸造相应的代币。 存储证明可以实现无需信任的跨链桥，因为目标链上的智能合约应用程序可以验证资产转移到源链上的桥智能合约的交易并铸造桥接资产。 然而，在许多情况下，可能会消除在链之间转移资产的需要，因为可以通过存储证明简单地证明另一个链上资产的所有权。
* **增强帐户抽象 (AA) 用例的用户体验**. AA 已在不同的链中实施，被认为是吸引首批 10 亿用户进入区块链领域的关键创新。 通过存储证明，钱包可以包含仅当钱包长时间未发送任何交易时恢复访问的附加功能。 还可以执行额外的检查，要求使用来自其他链的一些数据。

![典型的跨桥流量图像](/assets/typical-cross.bridge-flog-imagewebp.webp "典型的跨桥流量图像")

## 存储证明示例

在 EVM 兼容链上生成存储证明非常简单。 例如，Web3.js 库具有 getProof 函数，可以生成以太坊（以及其他 EVM 兼容链，例如 Polygon 或 BSC）上的合约状态证明。 必须将合约地址和合约的存储槽传递给该函数。

在以太坊中，智能合约使用键值存储在其存储中存储数据。 每条数据都存储在称为“存储槽”的特定位置。 存储槽是合约存储中的内存位置，由唯一索引标识。 让我们看一下部署在以太坊主网[0xcc…da8b](https://etherscan.io/address/0xcca577ee56d30a444c73f8fc8d5ce34ed1c7da8b#code)上的示例智能合约，其中包含以下代码。

![](/assets/blog-post-image-2-.webp)

\`owner\` 变量将存储在槽 0 中。 现在，为了生成该合约的“所有者”是地址 A 的证明，我们可以使用“getProof”函数，如下所示：

![](/assets/blog-post-image-3-.webp)

\
上面代码的输出看起来像这样：

![](/assets/blog-post-image-4-.webp)

返回的“storageProof”包含“owner”变量的存储证明。 由于以太坊使用 Merkle Patricia Trees 将账户状态及其存储提交到其状态，因此生成的存储可用于证明存储槽（或账户状态）。 然而，如前所述，这些证明的可扩展性不足以讨论跨链消息传输。 在此之上使用复杂的 ZK 数学可以减少验证证明所需的计算量。

## 那么存储证明如何与预言机进行比较和对比呢？

根据设计，区块链无法检索链下数据。 这使得区块链保持不可信，但也限制了智能合约根据现实世界事件做出决策的能力。 预言机也常用于获取历史区块链信息，因为直接获取这些数据非常具有挑战性，因此容易出错。

为了解决这个问题，创建了名为**oracles**的特殊实体来检索这些链下数据（或检索一些繁重的链下计算的结果）。 目前，这些预言机需要第三方（例如机构或节点运营商的去中心化网络）在链上提交数据，这些数据对用户和智能合约公开。 这种信任假设目前是不可避免的，但并不理想（尽管有几个团队正在努力最小化这种信任要求，例如 Pragma）

**[Chainlink](https://chain.link/)**是区块链预言机的一个示例，它提供各种现实世界数据（股票价格、天气数据等）、链下计算服务以最大限度地减少链上繁重计算的成本，以及跨链服务，在不同区块链之间读取和写入信息。

由于智能合约除了使用预言机之外没有其他方式可以了解现实世界中发生的事情，因此预言机已成为区块链生态系统中不可或缺的一部分。

## Starknet 上的预言机状态

在 Starknet 测试网上，前面提到的 Chainlink 目前提供 7 对加密货币的价格数据源，并已[与 Starkware 团队合作](https://www.coindesk.com/business/2023/02/06/starkware-partnering-with-chainlink-for-starknet-growth/)，以“进一步加速 StarkNet 生态系统的应用程序开发和总体增长”。 Chainlink 最大限度地减少了对分散节点网络的信任假设，这些节点提供来自链外来源的数据，但数据聚合发生在链外。

**[Pragma](https://www.empiric.network/)**和**[Stork Network](https://www.stork.network/)**是 Starknet 上最大的两家预言机提供商，在主网和测试网上运行。 除了多个加密货币对的价格行情之外，Pragma 还致力于在主网上实现可验证的随机性馈送，该馈送将允许协议请求链上的安全随机性。 Pragma 的价格反馈基于大型机构和做市商提交的价格，并且利用高效的 ZK 技术在链上进行价格聚合。

![](/assets/blog-post-image-5-.webp)



## 预言机可以通过存储证明来替代或改进吗？

在某些情况下，存储证明可以取代预言机。

并非预言机提供的所有数据实际上都需要由第三方提供。 在某些情况下，预言机提供的数据已经在链上可用（以链上存储或交易的形式），并且可以通过查看区块链的先前状态来检索。 在这些情况下，存储证明可以取代对第三方和预言机的信任，并允许智能合约完全依赖于加密承诺的安全性。

在其他情况下，存储</em>*证明，例如：</p>

* 预言机将信息从数据提供者传输到数据消费者。 然而，并非所有数据消费者都在同一条链上。 借助存储证明，可以对不同来源的数据完成一些**计算，并将结果导出到其他链**。
* 此类数据的首选源链是计算成本低廉的源链，并且可以在其他目标链上经济高效地完成证明验证。
* [Herodotus](https://www.herodotus.dev/)是该领域的研究领导者之一，他们使用存储证明和 ZK 数学提供跨不同以太坊链的跨域数据访问。 Pragma 还与希罗多德合作，在不久的将来实现跨链预言机支持。
* 存储证明可以**统一多个汇总的状态**，甚至允许在</em>以太坊层之间进行同步读取*。</li>
* 另一个增强功能是对链上发布的历史数据进行**去信任检索**。 有状态的区块链（例如以太坊和 Starknet）通过专门的数据结构（例如 Merkle/Verkle 树和 MPT）记录并以加密方式保存其状态。 这使得证明这些结构中存储的任何数据的包含成为可能。 因此，在链上发布的任何过去的数据也可以在其他应用程序中被信任、检索和使用（甚至不一定在同一条链上）。 这些存储证明允许智能合约访问甚至可以追溯到创世块的信息。
* Pragma 正在研究在 Starknet 上开发作为 L3 的预言机的可行性，可以从该预言机将数据“拉取”到其他链上并使用存储证明进行验证。 在像 Starknet 这样计算成本低的网络之上将预言机置于不同的域中的好处包括以下几点：
* 由于 L3 可以是高度可定制的链，因此可以将各种参数调整为**更快地在区块**上达成共识，从而大大减少预言机的数据延迟。
* 结合存储证明，**低延迟数据可以异步传输到其他链，**在源链达成共识后。
* 通过在 L3 中开发内置系统来打击不诚实的数据提供商，可以**增强对数据的信任**。 如果给予适当的激励，L3 上的数据提供者可以将其资产作为发布正确数据的保证。 由于在其他链可以使用数据之前需要整个网络在 L3 上达成共识，因此预言机提供的数据可以被认为是由验证者在 L3 上的权益来保证的。</ul>

# 结论

在过去的几个月里，L2 在以太坊上的使用不断增加，让我们对该行业的未来有了更清晰的认识。 L2 的叙述已经受到[Starknet](https://www.starknet.io/en)Optimism</a>和[Arbitrum](https://arbitrum.io/)等网络的关注

 然而，其增长的主要支撑之一是实施去中心化的跨链消息传递系统。 尽管仍处于初级阶段，但存储证明有望对这个问题做出令人难以置信的改进。</p> 

非常感谢[Marcello Bardus](https://twitter.com/0xmarcello)&[Kacper Koziol](https://twitter.com/kacperkozi)审阅本文。