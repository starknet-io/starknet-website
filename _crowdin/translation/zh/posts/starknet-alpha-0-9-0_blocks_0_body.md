### TL;DR

* 现在测试网上强制收费，主网上很快就会收费
* 合同工厂模式现在成为可能！
* Starknet 正在引入合约类
* 委托调用替换为库调用

### 介绍

我们很高兴推出 Starknet Alpha 0.9.0！ 这是一个重要的版本，Starknet 在其成熟度方面迈出了重要一步，对功能和协议设计都进行了实质性的补充。

费用是强制性的（目前仅在测试网上，直到 0.9.0 版本将在主网上上线）——任何繁荣的 L2 都必须有自己独立的费用系统。 在 0.8.0 版本中将费用作为可选功能引入后，我们现在有信心将其作为协议的核心组成部分，并将其强制执行。 更多详细信息如下。

协议级别的另一个重大变化是引入合约类和类/实例分离。 这允许更直接地使用“delegate_call”功能和现有合约的部署，从而在 Starknet 上启用工厂模式。

### 合约类别

受到面向对象编程的启发，我们区分了合约代码及其实现。 我们通过将合约分为类和实例来实现这一点。

合约类是合约的定义：它的 Cairo 字节码、提示信息、入口点名称以及明确定义其语义所需的一切。 每个类都通过其类哈希来标识（类似于 OOP 语言中的类名）。

合约实例，或者简称为合约，是对应于某个类的已部署合约。 请注意，只有合约实例才具有合约的行为，即拥有自己的存储空间并且可以由交易/其他合约调用。 合约类不一定在 Starknet 中有部署的实例。 类的引入伴随着一些协议的改变。

#### “申报”交易

我们向 Starknet 引入了一种新的交易类型： [“声明”](https://docs.starknet.io/docs/Blocks/transactions#declare-transaction) 交易，它允许声明合约类。 与“部署”事务不同，这不会部署该类的实例。 Starknet 的状态将包括已声明类别的列表。 可以通过新的“声明”事务添加新类。

#### “部署”系统调用和合同工厂。

一旦声明了一个类，即接受了相应的“declare”事务，我们就可以部署该类的新实例。 为此，我们使用新的“deploy”系统调用，它采用以下参数：

* 类哈希
* 盐
* 构造函数参数

然后，“deploy”系统调用将部署该合约类的一个新实例，其 [地址](https://docs.starknet.io/docs/Contracts/contract-address) 将由上面的三个参数和部署者地址（调用系统调用的合约）确定。

将部署包含在调用事务中使我们能够对部署进行定价并收取费用，而不必以不同的方式对待部署和调用。 有关部署费用的更多信息，请参阅 [文档](https://docs.starknet.io/docs/Fees/fee-mechanism#deployed-contracts)。

此功能将合约工厂引入 Starknet，因为任何合约都可以调用“deploy”系统调用，创建新合约。

#### 从“代表调用”转向“库调用”

类的引入使我们能够解决以太坊委托调用机制中的一个众所周知的问题：当一个合约对另一个合约执行委托调用时，它只需要它的类（它的代码）而不是实际的实例（它的存储）。 因此，在进行委托调用时必须指定特定的合约实例是不好的做法（事实上，它导致了以太坊合约中的一些错误）——只需要指定类。

旧的“delegate_call”系统调用现在已被弃用（已部署的旧合约将继续运行，但使用“delegate_call”的合约将不再编译），并被新的library_call系统调用所取代，该系统调用获取类哈希（先前声明的类）而不是合约实例地址。 请注意，库调用中只涉及一个实际合约，因此我们避免了调用合约和实现合约之间的歧义。

#### 新的 API 端点

我们向 API 添加了两个新端点，允许检索与类相关的数据：

* \`get_class_by_hash\`：返回给定类哈希的类定义
* get_class_hash_at：返回给定合约地址的已部署合约的类哈希值

请注意，要直接获取已部署合约的类，您可以使用旧的“get_full_contract”端点，而不是通过上述两种方法，该端点将在未来版本中重命名。 上述所有端点也可以从 [Starknet CLI](https://docs.starknet.io/docs/CLI/commands)使用。

#### 费用

我们继续将费用纳入 Starknet，使其成为 \[invoke](https://docs.Starknet.io/docs/Blocks/transactions#invoke-function)\ 交易的强制性费用（首先在测试网，后来也在主网上）。 此时“声明”交易将不需要费用。 同样，“部署”交易也不需要费用，但请注意，这种交易类型很可能在未来版本中被弃用。

该领域仍存在几个悬而未决的问题，其中最突出的问题是如何收取合约声明和 Starknet 账户部署费用。 我们将在未来的版本中解决这些问题。

### 下一步是什么？

按照我们 [于 2 月](https://medium.com/starkware/starknet-on-to-the-next-challenge-96a39de7717)宣布的路线图，我们致力于提高 Starknet 的整体性能，特别是排序器的性能，以使用户更快地获得有关其交易的反馈。 在下一个版本中，我们计划将并行化引入定序器中，从而实现更快的块生产。

Starknet 的下一个主要版本将重点关注 Starknet 帐户的结构，其方式类似于 [ERC-4337](https://medium.com/infinitism/erc-4337-account-abstraction-without-ethereum-protocol-changes-d75c9d94dc4a)。 至此，我们将最终确定 Starknet 帐户的行为方式，向大规模采用迈出又一大步！