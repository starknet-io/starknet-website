区块链的可扩展性一直是一个热门话题。 几乎每个区块链网络都以每秒处理大量交易（TPS）为卖点。 然而，TPS 并不是比较区块链网络的有效指标——这使得评估其相对性能成为一个挑战。 此外，大的 TPS 数字通常是有代价的 - 这就提出了一个问题：这些网络是否真的可以扩展，或者它们只是增加吞吐量？

因此，让我们研究一下如何定义可扩展性、为了实现它而进行了哪些权衡，以及为什么 Validity Rollups 是最终的可扩展性解决方案。

### 并非所有交易都是平等的

首先，我们需要断言，简单方便的 TPS 指标并不是可扩展性的准确衡量标准。

为了补偿执行交易的节点（并阻止用户用不必要的计算向网络发送垃圾邮件），区块链收取与区块链上的计算负担成比例的费用。 在以太坊中，计算负担的复杂性以*Gas 来衡量。*由于 Gas 是衡量交易复杂性的一种非常方便的方法，因此该术语在本文中也将用于非以太坊区块链，尽管它通常是以太坊特有的。

交易的复杂性以及消耗的 Gas 量差异很大。 比特币是去信任点对点交易的先驱，仅支持基本的比特币脚本。 这些从一个地址到另一个地址的简单传输只使用很少的gas。 相比之下，以太坊或 Solana 等智能合约链支持虚拟机和图灵完备的编程语言，允许更复杂的交易。 因此，像 Uniswap 这样的 dApp 需要更多的 Gas。

这就是为什么比较不同区块链的 TPS 没有意义。 相反，我们应该比较的是计算能力或吞吐量。

所有区块链都有一个（可变的）块大小和块时间，它们决定每个块可以处理多少个*计算单元*以及添加新块的速度**。 这两个变量共同决定了区块链的*吞吐量*。

### 是什么限制了可扩展性？

区块链致力于成为最大程度去中心化、包容性的网络。 为了实现这一目标，必须控制两个基本属性。

#### **1. 硬件要求**

区块链网络的去中心化取决于网络中最弱节点验证区块链并保持其状态的能力。 因此，运行节点的成本（硬件、带宽和存储）应保持尽可能低，以使尽可能多的个人成为去信任网络中的无需许可的参与者。

#### 2**。**状态增长

状态增长是指区块链增长的速度。 区块链每单位时间允许发生的吞吐量越大，区块链增长的速度就越快。 全节点存储网络的历史记录，并且它们必须能够验证网络的状态。 以太坊的状态是使用树等高效结构来存储和引用的。 随着状态的增长，新的叶子和分支会添加到其中，使得执行某些操作变得更加复杂和耗时。 随着链规模的增长，节点在最坏情况下的执行情况会变得更糟，这导致验证新块的时间不断增加。 随着时间的推移，这也会增加全节点同步所需的总时间。

### 增加吞吐量的不利影响

#### 1. 节点数

运行节点和节点数量的最低要求是：

* 比特币 1：350GB HDD 磁盘空间，5 Mbit/s 连接，1GB RAM，CPU >1 Ghz。 **节点数量：~10,000**
* Ethereum²：500GB+ SSD 磁盘空间、25 Mbit/s 连接、4–8GB RAM、CPU 2–4 核。 **节点数量：~6,000**
* Solana³：1.5TB+ SSD 磁盘空间、300 Mbit/s 连接、128GB RAM CPU 12+ 内核。 **节点数量：~1,200**

请注意，区块链吞吐量所需的节点的 CPU、带宽和存储要求越大，网络上的节点就越少，导致去中心化程度较弱，网络包容性较差。

#### 2. 同步全节点的时间

第一次运行节点时，它必须同步到所有现有节点，下载并验证从创世块到链末端的整个网络状态。 这个过程应该尽可能快速和高效，以允许任何人充当协议的无需许可的参与者。

以 Jameson Lopp 的[2020 比特币节点](https://blog.lopp.net/2020-bitcoin-node-performance-tests/)和[2021 节点同步测试](https://blog.lopp.net/2021-altcoin-node-sync-tests/)为指标，表 1 比较了在普通消费级 PC 上同步比特币、以太坊和 Solana 全节点所需的时间。

![表格1。 区块链吞吐量和节点同步比较](/assets/1_gmpi_1c9zipoc-znrh7b5q.png "表格1。 区块链吞吐量和节点同步比较")

表 1 表明，增加吞吐量会导致同步时间更长，因为需要处理和存储的数据越来越多。

虽然不断改进节点软件以缓解不断增长的区块链的挑战（减少磁盘占用空间、更快的同步速度、更强的崩溃恢复能力、某些组件的模块化等），但节点显然仍然无法跟上增长的步伐到吞吐量。

### 应如何定义可扩展性？

可扩展性是区块链领域中最容易被误解的术语。 虽然增加吞吐量是可取的，但这只是难题的一部分。

***可扩展性**意味着对于**相同的硬件**来说还有**个事务**。*

因此，可扩展性可以分为两类。

#### 定序器的可扩展性

排序描述了在网络中排序和处理事务的行为。 正如之前所确定的，任何区块链都可以通过增加区块大小和缩短区块时间来微不足道地增加其吞吐量，直到其去中心化的负面影响被认为过于显着为止。 但是，调整这些简单的参数并不能提供所需的改进。 理论上，以太坊的 EVM 可以处理高达约 2,000 TPS</a>

，这不足以满足长期的区块空间需求。 为了扩展测序，Solana 做出了一些令人印象深刻的创新：利用可并行执行环境和巧妙的共识机制，从而实现更高效的吞吐量。 但是，尽管有所改进，但它既不充分，也不可扩展。 随着 Solana 吞吐量的增加，运行节点和处理事务的硬件成本也会增加。</p> 



#### 验证可扩展性

*验证可扩展性描述了在不增加节点硬件成本的情况下增加吞吐量的方法。*具体来说，它指的是有效性证明等密码学创新。 它们是有效性汇总能够可持续扩展区块链的原因。

**什么是有效性汇总？**

有效性汇总（也称为“ZK-Rollups”）将计算和状态存储移至链外，但将少量某些数据保留在链上。 底层区块链上的智能合约维护 Rollup 的状态根。 在 Rollup 上，一批高度压缩的交易与当前状态根一起被发送到链下 Prover。 证明者计算交易，生成结果的有效性证明和新的状态根，并将其发送给链上验证者。 验证者验证有效性证明，维护 Rollup 状态的智能合约将其更新为证明者提供的新状态。

**有效性汇总如何在相同的硬件要求下进行扩展？**

尽管Provers确实需要高端硬件，但它们不会影响区块链的去中心化；因为交易的有效性是由数学上可验证的证明来保证的。

重要的是验证证据的要求。 由于所涉及的数据是高度压缩的，并且大部分是通过计算抽象出来的，因此它对底层区块链节点的影响最小*。*

验证者（以太坊节点）不需要高端硬件，批量的大小不会增加硬件要求。 节点只需要处理和存储状态转换和少量调用数据。 这允许所有以太坊节点使用其现有硬件验证有效性汇总批次。

**交易越多，越便宜**

在传统区块链中，发生的交易越多，随着区块空间被填满，每个人的成本就越高——并且用户需要在费用市场上相互出价才能将他们的交易纳入其中。

对于有效性汇总，这种动态是相反的。 在以太坊上验证一批交易是有一定成本的。 随着批次内交易数量的增加，验证批次的成本以指数速度增长。 尽管批量验证成本增加，但向批次添加更多交易会导致交易费用降低，因为它会在批次内的所有交易中摊销。 有效性汇总希望批次内有尽可能多的交易，以便所有用户可以共享验证费用。 随着批量大小增长到无穷大，每笔交易的摊销费用收敛为零，即，有效性汇总上的交易越多，每个人获得的费用就越便宜。

dYdX 是一款由 Validity Rollup 提供支持的 dApp，经常会看到批量大小超过 12,000 笔交易。 比较主网上与有效性汇总上相同交易的 Gas 消耗说明了可扩展性的收益：

在以太坊主网上结算 dYdX 交易：**200,000 Gas**

在 StarkEx 上结算 dYdX 交易：**<500 Gas**

另一种看待它的方式是：有效性汇总的主要成本与同一批次中的用户数量呈线性关系。



#### 为什么 Optimistic Rollup 的可扩展性不如人们想象的那么好

理论上，乐观汇总提供了与有效性汇总几乎相同的可扩展性优势。 但有一个重要的区别：乐观汇总针对平均情况进行优化，而有效性汇总针对最坏情况进行优化。 由于区块链系统在极其不利的条件下运行，因此针对最坏情况进行优化是实现安全的唯一方法。

在 Optimistic Rollup 最坏的情况下，欺诈检查器不会检查用户的交易。 因此，为了对抗欺诈，用户必须同步以太坊全节点、L2全节点，并自行计算可疑交易。

在有效性汇总最坏的情况下，用户只需要同步以太坊全节点即可验证有效性证明，从而节省了计算负担。

与有效性汇总相反，乐观汇总的成本与交易数量而不是用户数量成线性比例，这使得它们更加昂贵。



### 难题的最后一块——无需许可地访问 Rollup 状态

为了保证交易的有效性，用户只需要运行一个以太坊节点即可。 然而，用户和开发人员可能出于各种目的想要查看和运行 Rollup 的状态和执行。 *索引 L2 节点*完美地满足了这一需求。 它不仅允许用户查看网络中的交易，而且也是生态系统基础设施运行所必需的关键基础设施。 The Graph、Alchemy、Infura 等索引器；像 Chainlink 这样的 Oracle 网络和区块浏览器，所有这些都得到无需许可的索引 L2 节点的完全支持。



### 结论

许多解决区块链可扩展性的方法错误地专注于增加*吞吐量*。 但是，这忽略了吞吐量对节点的影响：处理块和存储网络历史记录的硬件要求不断增加，以及这如何抑制网络的去中心化。

随着有效性证明密码学的出现，区块链可以实现**真正的可扩展性**，不会给节点带来不断增加的成本负担，并允许广泛的去中心化。 现在，使用相同硬件进行更强大、更复杂的计算的更多交易是可能的，从而扭转了这一过程中的费用市场困境——有效性汇总上的活动越多，它就越便宜！

[SwagtimusPrime.eth](https://twitter.com/SwagtimusP?t=pO0L1vGIhuC-ZgWOusQYtA&s=09)和[路易斯·古斯曼](https://twitter.com/GuthL)

1 从<https://bitcoin.org/en/bitcoin-core/features/requirements>

² 从<https://ethereum.org/en/developers/docs/nodes-and-clients/>

³ 从<https://docs.solana.com/running-validator/validator-reqs>

⁴ 针对平均动态块大小进行了大幅简化和调整