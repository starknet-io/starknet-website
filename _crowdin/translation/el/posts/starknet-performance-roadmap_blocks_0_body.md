### TL;DR

* Τα rollups εγκυρότητας δεν περιορίζονται στην απόδοση με τον ίδιο τρόπο όπως το L1s. Αυτό δημιουργεί δυνητικά πολύ υψηλότερη TPS σε L2 κύλιση ισχύος.
* Ο οδικός χάρτης επιδόσεων StarkNet αντιμετωπίζει ένα βασικό στοιχείο του συστήματος: το sequencer.
* Παρουσιάζουμε εδώ τον οδικό χάρτη για βελτιώσεις επιδόσεων:\
  - Sequencer parallelization\
  - Μια νέα εφαρμογή σκουριάς για το Κάιρο VM\
  - Επανεφαρμογή Sequencer σε σκουριά\
* Οι παροιμίες, καθώς δοκιμάζονται από μάχες όπως είναι, δεν είναι το σημείο συμφόρησης και μπορούν να χειριστούν πολύ περισσότερα από όσα κάνουν τώρα!

### Εισαγωγή

Το StarkNet ξεκίνησε στο Mainnet σχεδόν πριν από ένα χρόνο. Ξεκινήσαμε να χτίζουμε το StarkNet εστιάζοντας στη λειτουργικότητα. Τώρα, μετατοπίζουμε την εστίαση στη βελτίωση της απόδοσης με μια σειρά βημάτων που θα βοηθήσουν στη βελτίωση της εμπειρίας του StarkNet.

Σε αυτό το post, εξηγούμε γιατί υπάρχει ένα ευρύ φάσμα βελτιστοποιήσεων που ισχύουν μόνο σε rollups, και θα μοιραστούμε το σχέδιό μας να εφαρμόσουμε αυτά τα βήματα στο StarkNet. Μερικά από αυτά τα βήματα εφαρμόζονται ήδη στο StarkNet Alpha 0.10.2, το οποίο κυκλοφόρησε στο Testnet στις Nov 16 και Χθες στο Mainnet. Αλλά πριν συζητήσουμε τις λύσεις, ας επανεξετάσουμε τους περιορισμούς και την αιτία τους.

### Περιορισμοί αποκλεισμού: κύλιση εγκυρότητας έναντι L1

Μια πιθανή προσέγγιση για την αύξηση της επεκτασιμότητας blockchain και την αύξηση της TPS θα ήταν να άρει τους περιορισμούς μπλοκ (σε ό,τι αφορά το αέριο/μέγεθος/μέγεθος) διατηρώντας παράλληλα τον χρόνο μπλοκ σταθερό. Αυτό θα απαιτούσε μεγαλύτερη προσπάθεια από τους παραγωγούς μπλοκ (επικυρωτές στο L1, Οι αλληλουχίες στο L2) και ως εκ τούτου απαιτούν μια πιο αποτελεσματική εφαρμογή αυτών των συστατικών. Για το σκοπό αυτό, τώρα μετατοπίζουμε την εστίαση σε βελτιστοποιήσεις StarkNet sequencer, τις οποίες περιγράφουμε λεπτομερέστερα στις παρακάτω ενότητες.

Εδώ τίθεται ένα φυσικό ερώτημα. Γιατί είναι βελτιστοποιήσεις αλληλουχίας περιορίζεται σε rollups εγκυρότητα, δηλαδή, γιατί δεν μπορούμε να εφαρμόσουμε τις ίδιες βελτιώσεις για L1 και να αποφευχθεί η πολυπλοκότητα των rollups εγκυρότητας εξ ολοκλήρου? Στην επόμενη ενότητα, ισχυριζόμαστε ότι υπάρχει μια θεμελιώδης διαφορά μεταξύ των δύο, επιτρέποντας ένα ευρύ φάσμα βελτιστοποιήσεων στο L2 που δεν ισχύουν για το L1.

### Γιατί η απόδοση L1 περιορισμένη?

Δυστυχώς, η άρση των περιορισμών μπλοκ στο L1 πάσχει από μια μεγάλη παγίδα. Με την αύξηση του ρυθμού ανάπτυξης της αλυσίδας, αυξάνουμε επίσης τις απαιτήσεις από πλήρη κόμβους, που προσπαθούν να συμβαδίσουν με την πιο πρόσφατη κατάσταση. Από L1 πλήρεις κόμβοι πρέπει να εκτελέσουν εκ νέου όλο το ιστορικό, μια υψηλή αύξηση του μεγέθους του μπλοκ (όσον αφορά το αέριο) θέτει ένα σημαντικό στέλεχος σε αυτά, και πάλι οδηγώντας σε ασθενέστερες μηχανές που εγκαταλείπουν το σύστημα και αφήνοντας την ικανότητα να λειτουργούν πλήρεις κόμβους μόνο σε αρκετά μεγάλες οντότητες. Ως αποτέλεσμα, οι χρήστες δεν θα είναι σε θέση να επαληθεύσουν το κράτος και να συμμετάσχουν στο δίκτυο χωρίς εμπιστοσύνη.

Αυτό μας αφήνει με την κατανόηση ότι η απόδοση L1 θα πρέπει να περιοριστεί, προκειμένου να διατηρηθεί ένα πραγματικά αποκεντρωμένο και ασφαλές σύστημα.

### Γιατί δεν τα ίδια εμπόδια επηρεάζουν κύρος rollups?

**Μόνο κατά την εξέταση της πλήρους προοπτικής του κόμβου βλέπουμε την πραγματική δύναμη που προσφέρει η εγκυρότητα.**Ένας πλήρης κόμβος L1 πρέπει να εκτελέσει ξανά ολόκληρο το ιστορικό για να εξασφαλίσει την ορθότητα του τρέχοντος κράτους. Οι κόμβοι StarkNet χρειάζονται μόνο για να επαληθεύσουν τις αποδείξεις STARK και αυτή η επαλήθευση παίρνει εκθετικά χαμηλότερο ποσό υπολογιστικών πόρων. Ειδικότερα, ο συγχρονισμός από το μηδέν δεν χρειάζεται να περιλαμβάνει την εκτέλεση. ένας κόμβος μπορεί να λάβει μια χωματερή της τρέχουσας κατάστασης από τους συνομηλίκους του και να επαληθεύσει μόνο μέσω μιας απόδειξης STARK ότι αυτή η κατάσταση είναι έγκυρη. Αυτό μας επιτρέπει να αυξήσουμε τη ροή του δικτύου χωρίς να αυξήσουμε τις απαιτήσεις από τον πλήρη κόμβο.

Ως εκ τούτου, συμπεραίνουμε ότι η αλληλουχία L2 υπόκειται σε ένα ολόκληρο φάσμα βελτιστοποιήσεων που δεν είναι δυνατές σε L1.

### Οδικός χάρτης επιδόσεων μπροστά

Στις επόμενες ενότητες, συζητούμε ποιες από αυτές έχουν προγραμματιστεί για το sequencer, το StarkNet.

### Αλληλουχία παραλληλισμού

Το πρώτο βήμα στον οδικό μας χάρτη ήταν να εισαγάγουμε την παραλληλισμό με την εκτέλεση συναλλαγών. Αυτό εισήχθη στο StarkNet άλφα 0.10.2, το οποίο κυκλοφόρησε χθες στο Mainnet. Τώρα βουτάμε σε αυτό που είναι παραλληλισμός (αυτό είναι ένα ημι-τεχνικό τμήμα, για να συνεχίσουμε στο οδικό χάρτη, πηδώντας στο επόμενο τμήμα).

Έτσι, τι σημαίνει “συναλλαγή παραλληλισμός” σημαίνει? Αφετέρου, η παράλληλη εκτέλεση ενός συνόλου συναλλαγών είναι αδύνατη καθώς μπορεί να εξαρτώνται διαφορετικές συναλλαγές. Αυτό απεικονίζεται στο ακόλουθο παράδειγμα. Εξετάστε ένα block με τρεις συναλλαγές από τον ίδιο χρήστη:

* Συναλλαγή A: ανταλλαγή USDC για ETH
* Συναλλαγή Β: να πληρώσει ETH για μια NFT
* Συναλλαγή C: ανταλλαγή USDT για BTC

Σαφώς, Tx A πρέπει να συμβεί πριν Tx B, αλλά Tx C είναι εντελώς ανεξάρτητη από τα δύο και μπορεί να εκτελεστεί παράλληλα. Εάν κάθε συναλλαγή απαιτεί 1 δευτερόλεπτο για να εκτελεστεί, τότε ο χρόνος παραγωγής μπλοκ μπορεί να μειωθεί από 3 δευτερόλεπτα σε 2 δευτερόλεπτα με την εισαγωγή παραλληλισμού.

Η ουσία του προβλήματος είναι ότι δεν γνωρίζουμε εκ των προτέρων τις εξαρτήσεις των συναλλαγών. Στην πράξη, μόνο όταν εκτελέσουμε τη συναλλαγή Β από το παράδειγμά μας βλέπουμε ότι βασίζεται σε αλλαγές που έγιναν με τη συναλλαγή Α. Πιο επίσημα, η εξάρτηση προκύπτει από το γεγονός ότι η συναλλαγή Β διαβάζει από αποθηκευτικά κελιά στα οποία έχει γράψει η συναλλαγή Α. Μπορούμε να σκεφτούμε τις συναλλαγές ως ένα γράφημα εξάρτησης, όπου υπάρχει διαφορά από τη συναλλαγή A έως τη συναλλαγή B iff A γράφει σε ένα κελί αποθήκευσης που διαβάζεται από το B, και έτσι πρέπει να εκτελεστεί πριν από το Β. Το ακόλουθο σχήμα δείχνει ένα παράδειγμα ενός τέτοιου γραφήματος εξάρτησης:

![](https://miro.medium.com/max/641/0*I-qGgxdJJmqmgZWM)

Στο παραπάνω παράδειγμα, κάθε στήλη μπορεί να εκτελεστεί παράλληλα, και αυτή είναι η βέλτιστη ρύθμιση (ενώ αφελώς, θα είχαμε εκτελέσει τις συναλλαγές 1-9 διαδοχικά).

Για να ξεπεράσουμε το γεγονός ότι το γράφημα εξάρτησης δεν είναι γνωστό εκ των προτέρων, εισάγουμε***αισιόδοξη παραλληλισμό***, στο πνεύμα του[BLOCK-STM](https://malkhi.com/posts/2022/04/block-stm/)που αναπτύχθηκε από Aptos Labs, στο sequencer. Κάτω από αυτό το παράδειγμα, επιχειρούμε με αισιοδοξία να εκτελέσουμε τις συναλλαγές παράλληλα και να εκτελέσουμε εκ νέου κατά την εύρεση μιας σύγκρουσης. Για παράδειγμα, μπορούμε να εκτελέσουμε τις συναλλαγές 1-4 από το σχήμα 1 παράλληλα, μόνο για να μάθετε μετά ότι Tx4 εξαρτάται από Tx1. Ως εκ τούτου, η εκτέλεσή του ήταν άχρηστη (τρέχαμε σε σχέση με την ίδια κατάσταση στην οποία εκτείναμε τον Tx1, ενώ θα έπρεπε να είχαμε τρέξει ενάντια στο κράτος που προκύπτει από την εφαρμογή Tx1). Σε αυτή την περίπτωση, θα εκτελέσουμε εκ νέου Tx4.

Σημειώστε ότι μπορούμε να προσθέσουμε πολλές βελτιστοποιήσεις στην κορυφή της αισιόδοξης παραλληλισμού. Για παράδειγμα, αντί να περιμένουμε αφελώς για κάθε εκτέλεση να τελειώσει, μπορούμε να ακυρώσουμε μια εκτέλεση τη στιγμή που βρίσκουμε μια εξάρτηση που την ακυρώνει.

Ένα άλλο παράδειγμα είναι η βελτιστοποίηση της επιλογής των συναλλαγών για επανεκτέλεση. Ας υποθέσουμε ότι ένα μπλοκ που αποτελείται από όλες τις συναλλαγές από το σχήμα 1 τροφοδοτείται σε μια αλληλουχία με πέντε πυρήνες CPU. Πρώτον, προσπαθούμε να εκτελέσουμε τις συναλλαγές 1-5 παράλληλα. Εάν η σειρά ολοκλήρωσης ήταν Tx2, Tx3, Tx4, Tx1, και τελικά Tx5, τότε θα βρούμε την εξάρτηση Tx1→Tx4 μόνο μετά Tx4 εκτελέστηκε ήδη - υποδεικνύοντας ότι θα πρέπει να εκτελεστεί εκ νέου. Αφελώς, μπορεί να θέλουμε να εκτελέσουμε εκ νέου Tx5 καθώς μπορεί να συμπεριφέρεται διαφορετικά δεδομένης της νέας εκτέλεσης του Tx4. Ωστόσο, αντί απλώς να εκτελέσετε εκ νέου όλες τις συναλλαγές μετά την ακύρωση του Tx4, μπορούμε να διανύσουμε το γράφημα εξάρτησης που έχει κατασκευαστεί από τις συναλλαγές των οποίων η εκτέλεση έχει ήδη τερματιστεί και μόνο επανεκτέλεση συναλλαγών που εξαρτώνται από Tx4.

### Μια νέα εφαρμογή Rust για το Κάιρο-VM

Οι έξυπνες συμβάσεις στο StarkNet είναι γραμμένες στο Κάιρο και εκτελούνται εντός του Καϊρό-VM, η οποία αναγράφεται στην προδιαγραφή[Χαρτί του Καΐρου](https://eprint.iacr.org/2021/1063.pdf). Επί του παρόντος, ο sequencer χρησιμοποιεί μια[εφαρμογή python](https://github.com/starkware-libs/cairo-lang/tree/master/src/starkware/cairo/lang/vm)του Cairo-VM. Για να βελτιστοποιήσουμε τις επιδόσεις της VM υλοποίησης, έχουμε ξεκινήσει μια προσπάθεια επανεγγραφής του VM στη σκουριά. Χάρη στο μεγάλο έργο του[Lambdaclass](https://lambdaclass.com/), που είναι από τώρα μια ανεκτίμητη ομάδα στο οικοσύστημα StarkNet, αυτή η προσπάθεια σύντομα θα καρποφορήσει.

Η εφαρμογή της VM,[καΐρο-rs](https://github.com/lambdaclass/cairo-rs), μπορεί τώρα να εκτελέσει τον τοπικό κώδικα του Καΐρου. Το επόμενο βήμα είναι η διαχείριση έξυπνων συμβάσεων εκτέλεσης και ενσωμάτωσης με τον πυθωνικό sequencer. Μόλις ενσωματωθεί με καϊρό-rs, η απόδοση του sequencerâ € ™️ s αναμένεται να βελτιωθεί σημαντικά.

### Επανεφαρμογή αλληλουχίας στο Rust

Η μετατόπιση από python στη σκουριά για βελτίωση της απόδοσης δεν περιορίζεται στο Κάιρο VM. Παράλληλα με τις βελτιώσεις που αναφέρθηκαν παραπάνω, σκοπεύουμε να ξαναγράψουμε το sequencer από το μηδέν στη σκουριά. Εκτός από τα εσωτερικά πλεονεκτήματα του Rust, αυτό παρουσιάζει μια ευκαιρία για άλλες βελτιστοποιήσεις στο sequencer. Καταχώρηση ενός ζευγαριού, μπορούμε να απολαύσουμε τα οφέλη του καΐρου-rs χωρίς την εναέρια επικοινωνία python-σκουριά, και μπορούμε να επανασχεδιάσουμε πλήρως τον τρόπο με τον οποίο η κατάσταση αποθηκεύεται και έχει πρόσβαση (η οποία σήμερα βασίζεται στη δομή[Patricia-Trie](https://docs.starknet.io/documentation/develop/State/starknet-state/#state_commitment)).

### Τι γίνεται με τις παροιμίες?

Σε όλο αυτό το post, δεν αναφέραμε το ίσως πιο διάσημο στοιχείο της εγκυρότητας rollups - ο prover. Κάποιος θα μπορούσε να φανταστεί ότι είναι η αναμφισβήτητα πιο εξελιγμένη συνιστώσα της αρχιτεκτονικής, θα πρέπει να είναι η συμφόρηση και, έτσι, το επίκεντρο της βελτιστοποίησης. Είναι ενδιαφέρον ότι είναι τα πιο “στάντα” συστατικά που είναι τώρα η συμφόρηση του StarkNet. Σήμερα, ιδιαίτερα με[αναδρομικές αποδείξεις](https://medium.com/starkware/recursive-starks-78f8dd401025), μπορούμε να χωρέσουμε πολύ περισσότερες συναλλαγές από την τρέχουσα κίνηση στο Testnet/Mainnet σε μια απόδειξη. Στην πραγματικότητα, σήμερα, StarkNet μπλοκ αποδεικνύεται παράλληλα με τις συναλλαγές StarkEx, όπου το τελευταίο μπορεί μερικές φορές να επιβαρυνθεί με αρκετές εκατοντάδες χιλιάδες νομισματοκοπεία NFT.

### Summary

Παραλληλισμός, Rust, και πολλά άλλα- στηρίξτε τον εαυτό σας για μια βελτιωμένη TPS στις επερχόμενες εκδόσεις StarkNet.