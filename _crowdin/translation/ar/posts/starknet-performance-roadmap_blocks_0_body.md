### TL;DR

* ولا تكون عمليات تكديس الصلاحية محدودة من حيث الإنتاج بنفس الطريقة التي يتم بها تكديسها من المستوى L1. وهذا ما قد يؤدي إلى ارتفاع كبير في عدد طلبات الترحيل من الفئة L2.
* وتتناول خارطة طريق الأداء StarkNet عنصرا رئيسيا في النظام: مسؤول التسلسل.
* نحن نقدم هنا خارطة الطريق لتحسين الأداء:\
  - التوازي بين تسلسلات\
  - تنفيذ دفع جديد للقرص VM للقاهرة\
  — إعادة تنفيذ تسلسل في السروق\/
* فالمخرجات، التي يجري اختبارها في المعركة، ليست الاختناقات ويمكنها التعامل مع ما هو أكثر بكثير مما تفعله الآن!

### مقدمة

بدأ StarkNet العمل على Mainnet قبل سنة تقريباً. بدأنا في بناء StarkNet بالتركيز على الوظائف. الآن، نحن نحول التركيز إلى تحسين الأداء بسلسلة من الخطوات التي ستساعد على تعزيز تجربة StarkNet.

في هذه الوظيفة، نفسر لماذا هناك مجموعة واسعة من التحسينات التي لا تنطبق إلا على عمليات الاستكشاف، وسوف نتشاطر خطتنا لتنفيذ هذه الخطوات على موقع StarkNet. وقد نُفذت بعض هذه الخطوات بالفعل في StarkNet Alpha 0.10.2، الذي صدر على Testnet في 16 تشرين الثاني/نوفمبر وبالأمس على Mainnet. ولكن قبل أن نناقش الحلول، دعونا نستعرض القيود وأسبابها.

### حدود الكتلة: تكديسات الصلاحية مقابل L1

وهناك نهج محتمل لزيادة إمكانية توسيع البلوكشين وزيادة TPS هو رفع حدود الكتلة (من حيث الغاز/الحجم) مع الحفاظ على استقرار وقت الكتلة. وهذا يتطلب المزيد من الجهد من منتجي الكتل (المدققون على L1, ومن ثم تدعو إلى تنفيذ هذه العناصر بمزيد من الكفاءة. وتحقيقا لهذه الغاية، نحول التركيز الآن إلى تحسين تسلسل StarkNet الذي نصفه بمزيد من التفصيل في الفروع التالية.

ويطرح هنا سؤال طبيعي. لماذا يتم تحسين التسلسل مقتصرة على عمليات الدوران الصحيحة، أي لماذا لا نستطيع تنفيذ نفس التحسينات على L1 وتجنب التعقيدات التي تنطوي عليها عملية تكديس الصلاحية تماما؟ وفي الفرع التالي، ندعي أن هناك فرقا جوهريا بين الاثنتين، السماح بطائفة واسعة من التحسينات على L2 التي لا تنطبق على L1.

### لماذا ناتج L1 محدود؟

ولسوء الحظ، فإن رفع قيود الكتلة على L1 يعاني من حفرة كبيرة. وبزيادة معدل نمو السلسلة، فإننا نزيد أيضا الطلبات من العقد الكاملة، الذين يحاولون مواكبة أحدث الولاية. بما أن العقد الكاملة L1 يجب أن تعيد تنفيذ كل التاريخ، زيادة كبيرة في حجم الكتلة (من حيث الغاز) تضع ضغطا كبيرا عليهم، ومرة أخرى تؤدي إلى تسرب آلات أضعف من النظام وتترك القدرة على تشغيل عقد كاملة للكيانات الكبيرة بما فيه الكفاية. ونتيجة لذلك، لن يتمكن المستخدمون من التحقق من حالة أنفسهم والمشاركة في الشبكة بدون ثقة.

ويتركنا هذا الأمر على فهم أن الناتج المحلي الإجمالي ينبغي أن يكون محدودا، من أجل الحفاظ على نظام لا مركزي وآمن حقا.

### لماذا لا تؤثر نفس الحواجز على صحة الطلقات؟

**فقط عند النظر في المنظور الكامل للعقدة نرى القوة الحقيقية التي توفرها التكديرات الصحيحة.**تحتاج عقدة L1 الكاملة إلى إعادة تنفيذ التاريخ بأكمله لضمان صحة الدولة الحالية. تحتاج عقد StarkNet فقط إلى التحقق من أدلة STARK، وهذا التحقق يتطلب كمية أقل من الموارد الحسابية. وعلى وجه الخصوص، لا ينبغي للمزامنة من الصفر أن تنطوي على تنفيذ؛ قد تتلقى عقدة إغراق من الحالة الراهنة من أقرانها ولا تتحقق إلا من خلال إثبات أن هذه الحالة صحيحة. وهذا يسمح لنا بزيادة إنتاجية الشبكة دون زيادة المتطلبات من كامل العقدة.

ولذلك نخلص إلى أن مخرج التسلسل L2 يخضع لطائفة كاملة من التحسينات التي لا يمكن تحقيقها في التسلسل L1.

### خريطة طريق الأداء في المستقبل

وفي الفروع التالية، نناقش أي من هذه الفروع مخططة حاليا لموظف تسلسل ستارك نيت.

### التوازي بين التسلسل

وكانت الخطوة الأولى في خارطة الطريق التي وضعناها هي تحقيق التوازي مع تنفيذ المعاملة. تم إدخال هذا في StarkNet Alpha 0.10.2، الذي تم إصداره أمس في Mainnet. ونحن نسعى الآن إلى تحقيق التوازي (هذا قسم شبه تقني، لمواصلة العمل على خارطة الطريق، والقفز إلى القسم التالي).

فما الذي يعنيه إذن "توازي المعاملات"؟ ومن المؤسف أن تنفيذ مجموعة من المعاملات بالتوازي أمر مستحيل لأن المعاملات المختلفة قد تكون معتمدة. ويتضح ذلك في المثال التالي. فكر في كتلة تحتوي على ثلاث معاملات من نفس المستخدم:

* المعاملة ألف: مبادلة USDC مع ETH
* المعاملة باء: دفع ETH لـ NFT
* المعاملة جيم: مبادلة USDT مع BTC

ومن الواضح أن التوكس ألف يجب أن يحدث قبل التوكس باء، ولكن التوكس جيم مستقل تماما عن كليهما ويمكن تنفيذه بالتوازي. إذا كانت كل معاملة تتطلب ثانية واحدة لتنفيذها، عندئذ يمكن تقليل وقت إنتاج الكتلة من 3 ثوان إلى ثوانين عن طريق إدخال التوازي.

وجوهر المشكلة هو أننا لا نعرف مسبقا التبعية للمعاملة. ومن الناحية العملية، لا نرى أنها تعتمد على التغييرات التي تجريها المعاملة ألف إلا عندما ننفذ المعاملة باء من مثالنا. ومن الناحية الرسمية، ينبع التبعية من حقيقة أن المعاملة باء تفسر من خلايا التخزين التي كتبتها المعاملة ألف. يمكننا أن نفكر في المعاملات على أنها تشكل رسم بياني للتبعية، عندما يكون هناك حافة من المعاملة ألف إلى المعاملة باء ألف يكتب إلى خلية تخزين يقرأها باء، ومن ثم يتعين إعدامه قبل ب. ويبين الشكل التالي مثالا على هذا الرسم البياني للاتكال على النحو التالي:

![](https://miro.medium.com/max/641/0*I-qGgxdJJmqmgZWM)

وفي المثال الوارد أعلاه، يمكن تنفيذ كل عمود بالتوازي، وهذا هو الترتيب الأمثل (على الرغم من أننا سذاجون، كنا سننفذ المعاملات من 1 إلى 9 بالتتابع).

للتغلب على حقيقة أن الرسم البياني للتبعية غير معروف مسبقاً، نقدم***التوازي المتفائل***، بروح[BLOCK-STM](https://malkhi.com/posts/2022/04/block-stm/)الذي طوره Aptos Labs، إلى تسلسل StarkNet. وفي إطار هذا النموذج، نحاول بتفاؤل إجراء المعاملات بالتوازي مع إعادة تنفيذها عند العثور على تصادم. على سبيل المثال، يمكننا تنفيذ المعاملات من 1-4 من الشكل 1 بالتوازي، فقط لمعرفة بعد ذلك أن Tx4 تعتمد على Tx1. ومن ثم كان تنفيذه عديم الفائدة (قمنا بتشغيله بالنسبة إلى نفس الدولة التي قمنا بتشغيل Tx1 ضدها، بينما كان يجب علينا تشغيله ضد الحالة الناتجة عن تطبيق Tx1). وفي تلك الحالة، سنعيد تنفيذ Tx4.

لاحظ أنه يمكننا أن نضيف العديد من التحسينات إلى جانب التوازي المتفائل. على سبيل المثال، بدلا من الانتظار بسذاجة حتى تنتهي كل عملية إعدام، يمكننا إجهاض التنفيذ في اللحظة التي نجد فيها تبعية تبطله.

ومن الأمثلة الأخرى على ذلك تحسين اختيار المعاملات التي يتعين إعادة تنفيذها. لنفترض أن الكتلة التي تتكون من جميع المعاملات من الشكل 1 يتم تغذيتها في جهاز تسلسل مع خمس نواة لوحدة المعالجة المركزية. أولاً، نحاول تنفيذ المعاملات من 1 إلى 5 بالتوازي. إذا كان ترتيب الإكمال هو Tx2, Tx3, Tx4, Tx1, وأخيراً Tx5, ثم سنجد التبعية Tx1<unk> Tx4 فقط بعد أن تم تنفيذ Tx4 بالفعل - مشيرا إلى أنه ينبغي إعادة تنفيذه. ولسوء الطالع، قد نريد إعادة تنفيذ Tx5 أيضا لأنها قد تتصرف بطريقة مختلفة بالنظر إلى التنفيذ الجديد لـ Tx4. ولكن بدلا من مجرد إعادة تنفيذ جميع المعاملات بعد إلغاء Tx4 الآن، يمكننا تجاوز الرسم البياني للتبعية المبني من المعاملات التي أنهى تنفيذها بالفعل و فقط إعادة تنفيذ المعاملات التي تعتمد على Tx4.

### ألف - تنفيذ جديد لمؤتمر القاهرة

العقود الذكية في StarkNet مكتوبة في القاهرة ويتم تنفيذها داخل القاهرة، والتي تظهر في[ورقة القاهرة](https://eprint.iacr.org/2021/1063.pdf). في الوقت الحالي، يستخدم عامل التسلسل تطبيق[بايثون](https://github.com/starkware-libs/cairo-lang/tree/master/src/starkware/cairo/lang/vm)للقاهرة . ولتحسين أداء تنفيذ آلية VM إلى أقصى حد، بدأنا جهوداً لإعادة كتابة آلية VM في حالة صدأ. بفضل العمل الرائع لـ[Lambdaclass](https://lambdaclass.com/)، وهذه الجهود التي أصبحت الآن فريقاً قيماً في النظام الإيكولوجي لستارك نيت، ستؤتي ثمارها قريباً.

يمكن الآن تنفيذ برنامج VM،[القاهرة](https://github.com/lambdaclass/cairo-rs)، تنفيذ رمز القاهرة الأصلي. الخطوة التالية هي التعامل مع تنفيذ العقود الذكية والتكامل مع جهاز التسلسل البيثوني. وبمجرد الاندماج مع القاهرة، من المتوقع أن يتحسن أداء المتتابع تحسناً كبيراً.

### إعادة تنفيذ التسلسل في الروت

إن تحولنا من بايثون إلى الاندفاع إلى تحسين الأداء لا يقتصر على آلية القاهرة للتحقيق. وإلى جانب التحسينات المشار إليها أعلاه، نعتزم إعادة كتابة أداة التسلسل من الصفر في السخرة. وبالإضافة إلى ميزات روست الداخلية، فإن هذا يمثل فرصة لإدخال تحسينات أخرى على متسلسلها. وبإدراج زوجين، يمكننا أن نستمتع بمزايا القاهرة بدون النفقات العامة للاتصالات بين زبائن البيتون، ويمكننا أن نعيد تصميم الطريقة التي يتم بها تخزين الدولة والوصول إليها (والتي تعتمد اليوم على بنية[باتريسيا - تريي](https://docs.starknet.io/documentation/develop/State/starknet-state/#state_commitment)).

### ماذا عن الأميرات؟

وطوال هذا المنصب، لم نذكر العنصر الأكثر شهرة في عمليات الترحيل - ألا وهو الوثيل. ويمكن للمرء أن يتصور أن العنصر الأكثر تطورا في الهندسة المعمارية ينبغي أن يكون الاختناق، ومن ثم التركيز على تحقيق المستوى الأمثل. ومن المثير للاهتمام أن المكونات "المعيارية" أكثر هي التي باتت الآن اختناق ستاركنيت. اليوم، خاصة مع[أدلة متكررة](https://medium.com/starkware/recursive-starks-78f8dd401025)، يمكننا أن نضع معاملات أكثر بكثير من حركة المرور الحالية على Testnet/ainnet لإثبات ذلك. في الواقع، اليوم، يتم إثبات كتل StarkNet جنبا إلى جنب مع معاملات StarkEx ، حيث يمكن أن يتكبد هذا الأخير أحيانا عدة مئات من الألوف من الألغام غير القابلة للتداول.

### Summary

التوازي، روست، وأكثر - تكافئ أنفسنا لتحسين TPS في إصدارات StarkNet القادمة.